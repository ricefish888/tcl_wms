打印("开始线边分配")
$线边库存结果集 = 数据查询(模型, "R101_线边库存数据源", "仓库ID", 仓库ID, "线边库位", 线边库位编码,"货品ID", 货品ID, "货主ID", 货主ID, "库存状态", 库存状态)
打印("线边库存结果集:"+$线边库存结果集)
如果($线边库存结果集!=空 && 列表大小($线边库存结果集)!=0) {
  $是否找到库存 = 1
  列表对象排序($线边库存结果集.库存, "库存数量", "升序")
  每个($库存 : $线边库存结果集.库存) {
    如果($未拣选数量>0 && $库存.库存数量>0) {
      $返回对象 = 创建对象()
      $返回对象.库存ID = $库存.库存ID
      $返回对象.库位ID = $库存.库位ID
      $返回对象.分配数量 = 0

      如果($未拣选数量>$库存.库存数量) {
        $返回对象.分配数量 = $库存.库存数量
        $未拣选数量 = $未拣选数量-$库存.库存数量
        $库存.库存数量 = 0
      }

      如果($未拣选数量<=$库存.库存数量) {
        $返回对象.分配数量 = $未拣选数量
        $库存.库存数量 = $库存.库存数量 - $未拣选数量
        $未拣选数量 = 0
      }

      打印("线边分配加入列表"+$返回对象)
      加入列表(返回列表, $返回对象)
    }
  }
}

打印("线边分配后未分配数量:"+$未拣选数量)
